#!/usr/bin/env python

import argparse
import sys
import os

sys.path.append(os.path.dirname(os.path.realpath(__file__)) + "/src")

from dataset import *
from supervisor import *
from handler import Handler

parser = argparse.ArgumentParser()
group = parser.add_mutually_exclusive_group()
group.add_argument('--init', action='store_true', help ="Initialize all available datasets")
group.add_argument('--purge', action='store_true', help ="Remove all datasets and databases")
group.add_argument('-c', '--create', nargs='+', help ="Create specified dataset(s)")
group.add_argument('-r', '--remove', nargs='+', help ="Remove specified dataset(s)")
group.add_argument('-f', '--fill',   nargs='+', help ="Fetch historical quotes")
group.add_argument('-u', '--update', nargs='+', help ="Update dataset with newest quotes")
group.add_argument('--dblist', action='store_true', help ="Show databases")
group.add_argument('--sqlstatus', action='store_true', help ="Show sql status")
group.add_argument('--sqlusers', action='store_true', help ="Show sql users")

if len(sys.argv) == 1:
    parser.print_help()
    sys.exit(1)

args = parser.parse_args()

DbSupervisor.establishMySqlConnection()
handler = Handler()

if args.init:
    handler.init()
elif args.purge:
    handler.purge()
elif args.create:
    handler.create(args.create)
elif args.remove:
    handler.remove(ags.remove)
elif args.fill:
    handler.fill(args.fill)
elif args.update:
    handler.update(args.update)
elif args.dblist:
    handler.dblist()
elif args.sqlstatus:
    handler.sqlstatus()
elif args.sqlusers:
    handler.sqlusers()
